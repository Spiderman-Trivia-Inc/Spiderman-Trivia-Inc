<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/leaderboard.css"> 
  <link rel="stylesheet" href="css/utility-classes.css">
  <!-- New CSS file for leaderboard styles -->
  <title>Leaderboard</title>
</head>
<body>
  <header>
    <img src="assets/icons/logo.svg" alt="logo">
    <aside>
      <img src="assets/icons/moon.svg" alt="theme-toggler">
      <h3>Hello, There</h3>
    </aside>
  </header>

  <article class="p-1" >
    <section class="leaderboard flex flex-col gap-2 items-start">
      <h1 class="page-title w-full">Leaderboard</h1>

      <div class="flex w-full gap-1 flex-wrap">
        <select id="subjectSelect" class="">
          <option value="1">Classic</option>
          <option value="2">Amazing</option>
          <option value="3">Marvel Cinematic Universe</option>
          <option value="4">Spiderverse</option>
        </select>

        <input id="searchInput" class="flex-1 p-1" placeholder="Search..."/>
      </div>
     
      <ol id="leaderboardList" class="leaderboard-list w-full flex flex-col">
        <!-- Leaderboard items will be populated here -->
      </ol>
    </section>
  </article>

  <footer>
    <p>
      &copy;
      <script> document.write(new Date().getFullYear());</script>
      SpiderMan Trivia Inc.
    </p>
    <img src="assets/icons/github.svg" alt="GitHub">
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const subjectSelect = document.getElementById('subjectSelect');
      const searchInput = document.getElementById('searchInput');
      const leaderboardList = document.getElementById('leaderboardList');

      // Function to fetch leaderboard data and update the HTML
      const fetchLeaderboard = async (subjectId) => {
        try {
          const response = await fetch(`http://localhost:3000/leaderboard/${subjectId}`);
          const data = await response.json();

          // Clear the existing leaderboard list
          leaderboardList.innerHTML = '';

          // Populate the leaderboard list with received data
          data.forEach((player, index) => {
            const listItem = document.createElement('li');
            listItem.innerHTML = `
              <span class="player-position">${index + 1}.</span>
              <span class="player-name">${player.username}</span>
              <span class="player-score">${player.total_score}</span>
            `;
            leaderboardList.appendChild(listItem);
          });
        } catch (error) {
          console.error('Error fetching leaderboard:', error);
          // Optionally, display an error message to the user
        }
      };

      // Event listener for subject select change
      subjectSelect.addEventListener('change', (event) => {
        const selectedSubjectId = event.target.value;
        fetchLeaderboard(selectedSubjectId);
      });

        // Event listener for search input keyup
  searchInput.addEventListener('keyup', () => {
    const searchValue = searchInput.value.toLowerCase();
    const playerNames = leaderboardList.querySelectorAll('.player-name');
    playerNames.forEach((playerName) => {
      const playerNameText = playerName.textContent.toLowerCase();
      const listItem = playerName.parentElement;
      if (playerNameText.includes(searchValue)) {
        listItem.style.display = 'flex';
      } else {
        listItem.style.display = 'none';
      }
    });
  })

      // Initial fetch of leaderboard data for the default subject
      const initialSubjectId = subjectSelect.value;
      fetchLeaderboard(initialSubjectId);
    });
  </script>
</body>
</html>
